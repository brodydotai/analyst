%%{ init: { 'theme': 'dark', 'themeVariables': { 'primaryColor': '#1f6feb', 'primaryTextColor': '#e6edf3', 'primaryBorderColor': '#58a6ff', 'lineColor': '#8b949e', 'secondaryColor': '#161b22', 'tertiaryColor': '#21262d', 'fontSize': '14px' } } }%%

graph TB
    subgraph USER["üßë USER (Brody)"]
        direction LR
        U1["Edit playbooks<br/>& guidelines"]
        U2["Review artifacts<br/>& outputs"]
        U3["Set strategic<br/>direction"]
    end

    subgraph ORCH["üéØ ORCHESTRATION ‚Äî Claude (Cowork)"]
        direction LR
        O1["Intake &<br/>interpret tasks"]
        O2["Delegate to<br/>sub-agents"]
        O3["Quality-check<br/>outputs"]
        O4["Maintain logs<br/>& shared state"]
    end

    subgraph AGENTS["‚ö° AGENT LAYER"]
        direction LR
        A1["üîß Codex<br/><i>Code builder</i><br/>Features, fixes,<br/>migrations"]
        A2["üîç Research<br/><i>Data gatherer</i><br/>Web, EDGAR,<br/>financials"]
        A3["üìä Analysis<br/><i>Report engine</i><br/>Reports, scores,<br/>verification"]
        A4["üì° Feed<br/><i>Ingestor</i><br/>RSS, filings,<br/>processing"]
        A5["üîÆ Future<br/><i>Expandable</i><br/>Deals, email,<br/>scheduling"]
    end

    subgraph DATA["üåê DATA LAYER"]
        direction LR
        D1["SEC EDGAR"]
        D2["Financial APIs"]
        D3["TradingView"]
        D4["OpenAI"]
        D5["RSS Feeds"]
        D6["MCP Connectors"]
    end

    subgraph STORE["üíæ ARTIFACT STORE"]
        direction LR
        S1["Supabase<br/><i>PostgreSQL + pgvector</i><br/>Watchlist, filings,<br/>articles, entities"]
        S2["File System<br/><i>Temporary</i><br/>Playbooks, reports,<br/>agent logs"]
    end

    subgraph FEEDBACK["üîÑ FEEDBACK LOOP"]
        direction LR
        F1["Verification<br/>scores"]
        F2["User approval<br/>signals"]
        F3["Outcome<br/>tracking"]
        F4["Playbook<br/>refinement"]
    end

    USER -->|"Task / Question / Review"| ORCH
    ORCH -->|"Directives via CLAUDE.md"| A1
    ORCH -->|"Spawn sub-agents"| A2
    ORCH -->|"Generate & verify"| A3
    ORCH -->|"Trigger ingestion"| A4
    ORCH -.->|"Future delegation"| A5

    A1 & A2 & A3 & A4 --> DATA
    DATA --> STORE
    STORE --> FEEDBACK
    FEEDBACK -->|"Scores & signals"| ORCH
    ORCH -->|"Results & artifacts"| USER

    classDef userStyle fill:#1a1a2e,stroke:#58a6ff,stroke-width:2px,color:#e6edf3
    classDef orchStyle fill:#0d2137,stroke:#58a6ff,stroke-width:3px,color:#e6edf3
    classDef agentStyle fill:#161b22,stroke:#30363d,stroke-width:1px,color:#e6edf3
    classDef dataStyle fill:#1a1520,stroke:#8957e5,stroke-width:1px,color:#e6edf3
    classDef storeStyle fill:#1a2010,stroke:#3fb950,stroke-width:1px,color:#e6edf3
    classDef feedStyle fill:#201a10,stroke:#d29922,stroke-width:1px,color:#e6edf3

    class USER userStyle
    class ORCH orchStyle
    class AGENTS agentStyle
    class DATA dataStyle
    class STORE storeStyle
    class FEEDBACK feedStyle
