---
description: Global architecture and tech stack rules for the Atlas News Terminal
globs: **/*
alwaysApply: true
---
# Atlas News Terminal: Core Principles

## 1. Tech Stack & Responsibilities
- **Python (api/python/ & core/python/):** Serverless functions for data ingestion and AI processing. Use FastAPI-style handlers but deploy as Vercel serverless functions.
  - `api/python/ingest/`: Vercel function triggered by Cron. Reads RSS feeds and dispatches tasks to QStash (Fan-Out pattern).
  - `api/python/process/`: Vercel function triggered by QStash webhook. Processes articles (extract, vectorize, dedupe, summarize, categorize).
  - `core/python/`: Shared logic (scrapers, processing, database, qstash clients).
- **Frontend (frontend/):** Next.js 15, Tailwind CSS, and shadcn/ui. Must be keyboard-centric (Terminal UI). Uses Supabase Realtime for live updates.
- **Database:** Supabase (PostgreSQL + pgvector). Use Supabase migrations, not Alembic (serverless constraint).
- **Task Queue:** Upstash QStash for async background processing.

## 2. Serverless Architecture
- **Fan-Out Pattern:** Ingest function dispatches individual tasks to QStash for each article URL. Process functions scale independently.
- **No Long-Running Loops:** Use Vercel Cron triggers, never `while True` loops.
- **QStash for Background Tasks:** Any processing > 10s must use QStash to avoid Vercel timeouts.
- **Real-time:** Use Supabase Realtime subscriptions, not raw WebSockets.

## 3. Data Integrity
- **Migrations:** Use Supabase migrations (database UI or CLI). Python models in `core/python/database/` should match schema.
- **Source of Truth:** Supabase schema is the source of truth. Python models are kept in sync.
- **Deduplication:** Every article must be vectorized before saving. Use pgvector cosine similarity > 0.9 to detect duplicates.

## 4. Development Strategy
- **Steel Thread:** Always prioritize "Vertical Slices." Ensure a feature works from ingestion → QStash → processing → database → UI before "polishing" individual modules.
- **Reference Docs:** Always consult @docs/architecture.md and @docs/roadmap.md before proposing structural changes.
- **No Scraping Logic Yet:** Focus on infrastructure and pipeline scaffolding first (as per current constraint).

## 5. Key Libraries
- **Scraping:** `newspaper4k` + `httpx` (NOT Scrapy - too heavy for serverless)
- **Task Queue:** `upstash-qstash` (NOT RabbitMQ - not serverless-native)
- **Database:** `supabase-py` for both Python functions
- **Real-time:** Supabase Realtime (built into Supabase client)
